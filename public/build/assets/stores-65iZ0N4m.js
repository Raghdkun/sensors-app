import{r as o,j as s,c as M,H as je}from"./app-Ceqq5dSL.js";import{S as ae,A as ve}from"./app-layout-DjmKgjDt.js";import{R as ge,C as R,a as oe,d as P,b as Ne,c as be,B as ce}from"./badge-Mv6pxrcU.js";import{a as H,B as N}from"./app-logo-icon-CdDhz7_B.js";import{C as te}from"./checkbox-ChzBoLwg.js";import{D as X,a as B,g as Y,e as G,f as J,b as K}from"./dialog-D_oEVVgX.js";import{I}from"./input-D0zEgClY.js";import{L as re}from"./label-F_uXc4TK.js";import{S as ke}from"./separator-4BbBDQcx.js";import{S as Q,T as de}from"./skeleton-C5-MN2jM.js";import{S as T}from"./spinner-DJM2zdHL.js";import{q,a as U}from"./index-H92Pz0xW.js";import{P as ie,T as Se,a as Ce,C as ze}from"./trash-2-pYPQVltt.js";import{S as me,A as _e}from"./server-CXi3Yj3d.js";/* empty css            */import"./index-DpGmPMZN.js";import"./index-j7bSEhQD.js";import"./index-DtzoCmJ-.js";import"./check-CR144Lvi.js";import"./loader-circle-BIKxyZHH.js";const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],W=H("CircleX",De);const we=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ee=H("Link2",we);const Ae=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Le=H("Pencil",Ae);const qe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Fe=H("Search",qe);const Qe=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],Te=H("Unlink",Qe),b=e=>({url:b.url(e),method:"get"});b.definition={methods:["get","head"],url:"/api/stores/available-devices"};b.url=e=>b.definition.url+q(e);b.get=e=>({url:b.url(e),method:"get"});b.head=e=>({url:b.url(e),method:"head"});const V=e=>({action:b.url(e),method:"get"});V.get=e=>({action:b.url(e),method:"get"});V.head=e=>({action:b.url({[e?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...e?.query??e?.mergeQuery??{}}}),method:"get"});b.form=V;const z=(e,t)=>({url:z.url(e,t),method:"post"});z.definition={methods:["post"],url:"/api/stores/{store}/devices"};z.url=(e,t)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=U(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return z.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+q(t)};z.post=(e,t)=>({url:z.url(e,t),method:"post"});const ue=(e,t)=>({action:z.url(e,t),method:"post"});ue.post=(e,t)=>({action:z.url(e,t),method:"post"});z.form=ue;const _=(e,t)=>({url:_.url(e,t),method:"delete"});_.definition={methods:["delete"],url:"/api/stores/{store}/devices/{device}"};_.url=(e,t)=>{Array.isArray(e)&&(e={store:e[0],device:e[1]}),e=U(e);const r={store:typeof e.store=="object"?e.store.id:e.store,device:typeof e.device=="object"?e.device.id:e.device};return _.definition.url.replace("{store}",r.store.toString()).replace("{device}",r.device.toString()).replace(/\/+$/,"")+q(t)};_.delete=(e,t)=>({url:_.url(e,t),method:"delete"});const he=(e,t)=>({action:_.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...t?.query??t?.mergeQuery??{}}}),method:"post"});he.delete=(e,t)=>({action:_.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...t?.query??t?.mergeQuery??{}}}),method:"post"});_.form=he;const le={available:Object.assign(b,b),link:Object.assign(z,z),unlink:Object.assign(_,_)},k=e=>({url:k.url(e),method:"get"});k.definition={methods:["get","head"],url:"/api/stores"};k.url=e=>k.definition.url+q(e);k.get=e=>({url:k.url(e),method:"get"});k.head=e=>({url:k.url(e),method:"head"});const Z=e=>({action:k.url(e),method:"get"});Z.get=e=>({action:k.url(e),method:"get"});Z.head=e=>({action:k.url({[e?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...e?.query??e?.mergeQuery??{}}}),method:"get"});k.form=Z;const D=e=>({url:D.url(e),method:"post"});D.definition={methods:["post"],url:"/api/stores"};D.url=e=>D.definition.url+q(e);D.post=e=>({url:D.url(e),method:"post"});const xe=e=>({action:D.url(e),method:"post"});xe.post=e=>({action:D.url(e),method:"post"});D.form=xe;const S=(e,t)=>({url:S.url(e,t),method:"get"});S.definition={methods:["get","head"],url:"/api/stores/{store}"};S.url=(e,t)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=U(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return S.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+q(t)};S.get=(e,t)=>({url:S.url(e,t),method:"get"});S.head=(e,t)=>({url:S.url(e,t),method:"head"});const ee=(e,t)=>({action:S.url(e,t),method:"get"});ee.get=(e,t)=>({action:S.url(e,t),method:"get"});ee.head=(e,t)=>({action:S.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...t?.query??t?.mergeQuery??{}}}),method:"get"});S.form=ee;const w=(e,t)=>({url:w.url(e,t),method:"put"});w.definition={methods:["put"],url:"/api/stores/{store}"};w.url=(e,t)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=U(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return w.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+q(t)};w.put=(e,t)=>({url:w.url(e,t),method:"put"});const fe=(e,t)=>({action:w.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"PUT",...t?.query??t?.mergeQuery??{}}}),method:"post"});fe.put=(e,t)=>({action:w.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"PUT",...t?.query??t?.mergeQuery??{}}}),method:"post"});w.form=fe;const E=(e,t)=>({url:E.url(e,t),method:"delete"});E.definition={methods:["delete"],url:"/api/stores/{store}"};E.url=(e,t)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=U(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return E.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+q(t)};E.delete=(e,t)=>({url:E.url(e,t),method:"delete"});const pe=(e,t)=>({action:E.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...t?.query??t?.mergeQuery??{}}}),method:"post"});pe.delete=(e,t)=>({action:E.url(e,{[t?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...t?.query??t?.mergeQuery??{}}}),method:"post"});E.form=pe;Object.assign(k,k),Object.assign(D,D),Object.assign(le,le),Object.assign(S,S),Object.assign(w,w),Object.assign(E,E);function He(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.content;const r=`; ${document.cookie}`.split("; XSRF-TOKEN=");return r.length===2?decodeURIComponent(r.pop()?.split(";").shift()||""):""}async function L(e,t="GET",r){const i={Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};return t!=="GET"&&t!=="HEAD"&&(i["X-CSRF-Token"]=He()),(await fetch(e,{method:t,headers:i,credentials:"include",body:r?JSON.stringify(r):void 0})).json()}function ye(e){const t=M.c(3),{type:r}=e;switch(r){case"Hub":{let i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(me,{className:"size-4"}),t[0]=i):i=t[0],i}case"THSensor":{let i;return t[1]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(de,{className:"size-4"}),t[1]=i):i=t[1],i}default:{let i;return t[2]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(_e,{className:"size-4"}),t[2]=i):i=t[2],i}}}function Ue({store:e,open:t,onOpenChange:r,onSaved:i}){const[c,y]=o.useState(""),[n,u]=o.useState(""),[g,v]=o.useState(!1),[j,x]=o.useState(null),d=!!e;o.useEffect(()=>{t&&(y(e?.store_number||""),u(e?.store_name||""),x(null))},[t,e]);const f=async p=>{p.preventDefault(),v(!0),x(null);try{const a={store_number:c,store_name:n};let C;if(d&&e?C=await L(w.url(e.id),"PUT",a):C=await L(D.url(),"POST",a),C.success)r(!1),i();else if(C.errors){const F=Object.values(C.errors).flat().join(", ");x(F)}else x(C.error||C.message||"Failed to save store")}catch(a){x(a instanceof Error?a.message:"An error occurred")}finally{v(!1)}};return s.jsx(X,{open:t,onOpenChange:r,children:s.jsx(B,{className:"sm:max-w-md",children:s.jsxs("form",{onSubmit:f,children:[s.jsxs(Y,{children:[s.jsx(G,{children:d?"Edit Store":"Add Store"}),s.jsx(J,{children:d?"Update store details.":"Create a new store to link devices to."})]}),s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(re,{htmlFor:"store_number",children:"Store Number"}),s.jsx(I,{id:"store_number",value:c,onChange:p=>y(p.target.value),placeholder:"e.g. 03795-02",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(re,{htmlFor:"store_name",children:"Store Name"}),s.jsx(I,{id:"store_name",value:n,onChange:p=>u(p.target.value),placeholder:"e.g. Hudson",required:!0})]}),j&&s.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[s.jsx(W,{className:"size-4 shrink-0"}),j]})]}),s.jsxs(K,{className:"mt-6",children:[s.jsx(N,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:g,children:"Cancel"}),s.jsxs(N,{type:"submit",disabled:g,children:[g&&s.jsx(T,{className:"mr-2 size-4"}),d?"Update":"Create"]})]})]})})})}function Oe({store:e,open:t,onOpenChange:r,onLinked:i}){const[c,y]=o.useState([]),[n,u]=o.useState(new Set),[g,v]=o.useState(!1),[j,x]=o.useState(!1),[d,f]=o.useState(null),[p,a]=o.useState(""),C=new Set(e.devices?.map(l=>l.device_id)||[]),F=o.useCallback(async()=>{v(!0),f(null);try{const l=await L(b.url());l.success&&l.devices?y(l.devices.map(h=>({id:h.deviceId,name:h.name,type:h.type,model:h.modelName,token:h.token}))):f(l.error||"Failed to load devices")}catch(l){f(l instanceof Error?l.message:"Failed to load devices")}finally{v(!1)}},[]);o.useEffect(()=>{t&&(u(new Set),a(""),F())},[t,F]);const A=c.filter(l=>!C.has(l.id)&&(l.name.toLowerCase().includes(p.toLowerCase())||l.type.toLowerCase().includes(p.toLowerCase())||l.id.toLowerCase().includes(p.toLowerCase()))),m=l=>{u(h=>{const O=new Set(h);return O.has(l)?O.delete(l):O.add(l),O})},se=()=>{n.size===A.length?u(new Set):u(new Set(A.map(l=>l.id)))},$=async()=>{if(n.size===0)return;x(!0),f(null);const l=c.filter(h=>n.has(h.id)).map(h=>({device_id:h.id,device_token:h.token,device_type:h.type,device_name:h.name,model_name:h.model,is_hub:h.type==="Hub"}));try{const h=await L(z.url(e.id),"POST",{devices:l});h.success?(r(!1),i()):f(h.error||"Failed to link devices")}catch(h){f(h instanceof Error?h.message:"Failed to link devices")}finally{x(!1)}};return s.jsx(X,{open:t,onOpenChange:r,children:s.jsxs(B,{className:"sm:max-w-lg",children:[s.jsxs(Y,{children:[s.jsxs(G,{children:["Link Devices to ",e.store_name]}),s.jsx(J,{children:"Select devices from your YoSmart account to link to this store."})]}),s.jsxs("div",{className:"mt-2 space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(Fe,{className:"text-muted-foreground absolute top-2.5 left-3 size-4"}),s.jsx(I,{placeholder:"Search devices...",className:"pl-9",value:p,onChange:l=>a(l.target.value)})]}),s.jsx("div",{className:"max-h-80 overflow-y-auto rounded-md border",children:g?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx(T,{className:"size-6"}),s.jsx("span",{className:"text-muted-foreground ml-2 text-sm",children:"Loading devices..."})]}):A.length===0?s.jsx("div",{className:"text-muted-foreground py-8 text-center text-sm",children:c.length===0?"No devices found in your account.":"All devices are already linked or no match found."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-muted/50 flex items-center gap-3 border-b px-3 py-2",children:[s.jsx(te,{checked:n.size===A.length&&A.length>0,onCheckedChange:se}),s.jsx("span",{className:"text-muted-foreground text-xs font-medium",children:n.size>0?`${n.size} of ${A.length} selected`:`Select all (${A.length})`})]}),A.map(l=>s.jsxs("label",{className:"hover:bg-muted/30 flex cursor-pointer items-center gap-3 border-b px-3 py-2.5 last:border-b-0",children:[s.jsx(te,{checked:n.has(l.id),onCheckedChange:()=>m(l.id)}),s.jsx(ye,{type:l.type}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"truncate text-sm font-medium",children:l.name}),s.jsxs("div",{className:"text-muted-foreground truncate text-xs",children:[l.type," · ",l.model," · ",l.id]})]})]},l.id))]})}),C.size>0&&s.jsxs("p",{className:"text-muted-foreground text-xs",children:[C.size," device",C.size!==1?"s":""," already linked (hidden above)."]}),d&&s.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[s.jsx(W,{className:"size-4 shrink-0"}),d]})]}),s.jsxs(K,{className:"mt-2",children:[s.jsx(N,{variant:"outline",onClick:()=>r(!1),disabled:j,children:"Cancel"}),s.jsxs(N,{onClick:$,disabled:j||n.size===0,children:[j&&s.jsx(T,{className:"mr-2 size-4"}),"Link ",n.size>0?`${n.size} Device${n.size!==1?"s":""}`:"Devices"]})]})]})})}function $e({store:e,open:t,onOpenChange:r,onDeleted:i}){const[c,y]=o.useState(!1),n=async()=>{y(!0);try{(await L(E.url(e.id),"DELETE")).success&&(r(!1),i())}catch{}finally{y(!1)}};return s.jsx(X,{open:t,onOpenChange:r,children:s.jsxs(B,{className:"sm:max-w-md",children:[s.jsxs(Y,{children:[s.jsx(G,{children:"Delete Store"}),s.jsxs(J,{children:["Are you sure you want to delete ",s.jsx("strong",{children:e.store_name})," (",e.store_number,")? This will unlink all ",e.devices_count," device",e.devices_count!==1?"s":""," and cannot be undone."]})]}),s.jsxs(K,{className:"mt-4",children:[s.jsx(N,{variant:"outline",onClick:()=>r(!1),disabled:c,children:"Cancel"}),s.jsxs(N,{variant:"destructive",onClick:n,disabled:c,children:[c&&s.jsx(T,{className:"mr-2 size-4"}),"Delete Store"]})]})]})})}function Re({store:e,onEdit:t,onDelete:r,onRefresh:i}){const[c,y]=o.useState(!1),[n,u]=o.useState(e.devices||[]),[g,v]=o.useState(!1),[j,x]=o.useState(!1),[d,f]=o.useState(null),p=o.useCallback(async()=>{v(!0);try{const m=await L(S.url(e.id));m.success&&m.store?.devices&&u(m.store.devices)}catch{}finally{v(!1)}},[e.id]);o.useEffect(()=>{c&&n.length===0&&p()},[c,n.length,p]);const a=async m=>{f(m.id);try{(await L(_.url({store:e.id,device:m.id}),"DELETE")).success&&(u($=>$.filter(l=>l.id!==m.id)),i())}catch{}finally{f(null)}},C=()=>{p(),i()},F=n.filter(m=>m.is_hub),A=n.filter(m=>!m.is_hub);return s.jsxs(s.Fragment,{children:[s.jsxs(R,{className:"transition-shadow hover:shadow-md",children:[s.jsx(oe,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"bg-primary/10 text-primary flex size-10 items-center justify-center rounded-lg",children:s.jsx(ae,{className:"size-5"})}),s.jsxs("div",{children:[s.jsx(Ne,{className:"text-base",children:e.store_name}),s.jsx(be,{className:"font-mono text-xs",children:e.store_number})]})]}),s.jsx("div",{className:"flex items-center gap-1",children:s.jsx(ce,{variant:e.is_active?"default":"secondary",className:"text-xs",children:e.is_active?"Active":"Inactive"})})]})}),s.jsxs(P,{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(me,{className:"text-muted-foreground size-3.5"}),s.jsxs("span",{className:"text-muted-foreground",children:[e.hubs_count," hub",e.hubs_count!==1?"s":""]})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(de,{className:"text-muted-foreground size-3.5"}),s.jsxs("span",{className:"text-muted-foreground",children:[e.sensors_count," sensor",e.sensors_count!==1?"s":""]})]})]}),s.jsx(ke,{}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs(N,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[s.jsx(Ee,{className:"mr-1.5 size-3.5"}),"Link Devices"]}),s.jsxs(N,{size:"sm",variant:"outline",onClick:t,children:[s.jsx(Le,{className:"mr-1.5 size-3.5"}),"Edit"]}),s.jsxs(N,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:r,children:[s.jsx(Se,{className:"mr-1.5 size-3.5"}),"Delete"]}),s.jsx("div",{className:"flex-1"}),s.jsx(N,{size:"sm",variant:"ghost",onClick:()=>y(!c),className:"text-muted-foreground",children:c?s.jsxs(s.Fragment,{children:[s.jsx(Ce,{className:"mr-1 size-3.5"})," Hide Devices"]}):s.jsxs(s.Fragment,{children:[s.jsx(ze,{className:"mr-1 size-3.5"})," Show Devices (",e.devices_count,")"]})})]}),c&&s.jsx("div",{className:"mt-2 space-y-2",children:g?s.jsx("div",{className:"space-y-2",children:[1,2,3].map(m=>s.jsx(Q,{className:"h-12 w-full rounded-md"},m))}):n.length===0?s.jsx("div",{className:"text-muted-foreground rounded-md border border-dashed py-6 text-center text-sm",children:'No devices linked yet. Click "Link Devices" to get started.'}):s.jsxs(s.Fragment,{children:[F.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wide",children:"Hub"}),F.map(m=>s.jsx(ne,{device:m,unlinking:d===m.id,onUnlink:()=>a(m)},m.id))]}),A.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wide",children:"Sensors"}),A.map(m=>s.jsx(ne,{device:m,unlinking:d===m.id,onUnlink:()=>a(m)},m.id))]})]})})]})]}),s.jsx(Oe,{store:{...e,devices:n},open:j,onOpenChange:x,onLinked:C})]})}function ne(e){const t=M.c(28),{device:r,unlinking:i,onUnlink:c}=e;let y;t[0]!==r.device_type?(y=s.jsx(ye,{type:r.device_type}),t[0]=r.device_type,t[1]=y):y=t[1];let n;t[2]!==r.device_name?(n=s.jsx("div",{className:"truncate text-sm font-medium",children:r.device_name}),t[2]=r.device_name,t[3]=n):n=t[3];let u;t[4]!==r.model_name?(u=r.model_name&&s.jsxs(s.Fragment,{children:[" · ",r.model_name]}),t[4]=r.model_name,t[5]=u):u=t[5];let g;t[6]!==r.device_id?(g=s.jsx("span",{className:"ml-1 font-mono opacity-60",children:r.device_id}),t[6]=r.device_id,t[7]=g):g=t[7];let v;t[8]!==r.device_type||t[9]!==u||t[10]!==g?(v=s.jsxs("div",{className:"text-muted-foreground truncate text-xs",children:[r.device_type,u,g]}),t[8]=r.device_type,t[9]=u,t[10]=g,t[11]=v):v=t[11];let j;t[12]!==n||t[13]!==v?(j=s.jsxs("div",{className:"min-w-0 flex-1",children:[n,v]}),t[12]=n,t[13]=v,t[14]=j):j=t[14];let x;t[15]!==r.is_hub?(x=r.is_hub&&s.jsx(ce,{variant:"outline",className:"text-xs",children:"Hub"}),t[15]=r.is_hub,t[16]=x):x=t[16];let d;t[17]!==i?(d=i?s.jsx(T,{className:"size-3.5"}):s.jsx(Te,{className:"size-3.5"}),t[17]=i,t[18]=d):d=t[18];let f;t[19]!==c||t[20]!==d||t[21]!==i?(f=s.jsx(N,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive size-8 p-0",onClick:c,disabled:i,title:"Unlink device",children:d}),t[19]=c,t[20]=d,t[21]=i,t[22]=f):f=t[22];let p;return t[23]!==y||t[24]!==j||t[25]!==x||t[26]!==f?(p=s.jsxs("div",{className:"bg-muted/40 flex items-center gap-3 rounded-md px-3 py-2",children:[y,j,x,f]}),t[23]=y,t[24]=j,t[25]=x,t[26]=f,t[27]=p):p=t[27],p}function Pe(){const[e,t]=o.useState([]),[r,i]=o.useState(!0),[c,y]=o.useState(null),[n,u]=o.useState(!1),[g,v]=o.useState(null),[j,x]=o.useState(null),d=o.useCallback(async()=>{try{i(!0),y(null);const a=await L(k.url());a.success&&a.stores?t(a.stores):y(a.error||"Failed to load stores")}catch(a){y(a instanceof Error?a.message:"Failed to load stores")}finally{i(!1)}},[]);o.useEffect(()=>{d()},[d]);const f=()=>{v(null),u(!0)},p=a=>{v(a),u(!0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Stores"}),s.jsx("p",{className:"text-muted-foreground text-sm",children:"Manage your stores and link YoSmart devices to each location."})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(N,{variant:"outline",size:"sm",onClick:d,disabled:r,children:[s.jsx(ge,{className:`mr-1.5 size-3.5 ${r?"animate-spin":""}`}),"Refresh"]}),s.jsxs(N,{size:"sm",onClick:f,children:[s.jsx(ie,{className:"mr-1.5 size-3.5"}),"Add Store"]})]})]}),c&&s.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-4 py-3 text-sm text-destructive",children:[s.jsx(W,{className:"size-4 shrink-0"}),c,s.jsx(N,{variant:"ghost",size:"sm",className:"ml-auto",onClick:d,children:"Retry"})]}),r&&e.length===0&&s.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[1,2,3].map(a=>s.jsxs(R,{children:[s.jsx(oe,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Q,{className:"size-10 rounded-lg"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(Q,{className:"h-4 w-32"}),s.jsx(Q,{className:"h-3 w-20"})]})]})}),s.jsxs(P,{children:[s.jsx(Q,{className:"h-4 w-40"}),s.jsx(Q,{className:"mt-3 h-8 w-full"})]})]},a))}),!r&&e.length===0&&!c&&s.jsx(R,{className:"border-dashed",children:s.jsxs(P,{className:"flex flex-col items-center justify-center py-12",children:[s.jsx("div",{className:"bg-muted mb-4 flex size-16 items-center justify-center rounded-full",children:s.jsx(ae,{className:"text-muted-foreground size-8"})}),s.jsx("h3",{className:"text-lg font-semibold",children:"No stores yet"}),s.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"Create your first store to start linking YoSmart devices."}),s.jsxs(N,{className:"mt-4",onClick:f,children:[s.jsx(ie,{className:"mr-1.5 size-4"}),"Add Your First Store"]})]})}),e.length>0&&s.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:e.map(a=>s.jsx(Re,{store:a,onEdit:()=>p(a),onDelete:()=>x(a),onRefresh:d},a.id))}),s.jsx(Ue,{store:g,open:n,onOpenChange:u,onSaved:d}),j&&s.jsx($e,{store:j,open:!!j,onOpenChange:a=>!a&&x(null),onDeleted:d})]})}const Ie=[{title:"Dashboard",href:"/dashboard"},{title:"Stores",href:"/stores"}];function ds(){const e=M.c(2);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx(je,{title:"Store Management"}),e[0]=t):t=e[0];let r;return e[1]===Symbol.for("react.memo_cache_sentinel")?(r=s.jsxs(ve,{breadcrumbs:Ie,children:[t,s.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-4 md:p-6",children:s.jsx(Pe,{})})]}),e[1]=r):r=e[1],r}export{ds as default};
