import{r as T,u as me,j as t,c as z,H as xe}from"./app-pkigXPgA.js";import{T as q,a as G,b as J,A as ue}from"./app-layout-CNkL_DMD.js";import{C as _,a as W,b as V,c as Q,d as H,R as Y,B as K}from"./badge-BO4UtMQR.js";import{a as P,B}from"./app-logo-icon-B5cJjaRc.js";import{S as F,T as te}from"./skeleton-Bzr2k9W0.js";import{S as fe}from"./separator-CIj1QmoC.js";import{S as I}from"./spinner-CTIKhrD6.js";import{C as re}from"./circle-alert-CbFTDtrd.js";import{A as ae,S as se}from"./server-CC3qO3lU.js";import{W as Z,D as he,C as pe}from"./wifi-off-DE1f9tCp.js";import{d as ge}from"./index-H92Pz0xW.js";/* empty css            */import"./index-B_wyd2HL.js";import"./index-CBa_LQiU.js";import"./loader-circle-B1UB83vA.js";const je=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"13",key:"c6fn6x"}]],ye=P("BatteryFull",je);const Ne=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]],be=P("BatteryLow",Ne);const ve=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}]],ke=P("BatteryMedium",ve);const we=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],Se=P("Signal",we);const Ce=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],Te=P("Snowflake",Ce);const ze=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],le=P("Wifi",ze);function oe(){const r=document.querySelector('meta[name="csrf-token"]');if(r)return r.content;const s=`; ${document.cookie}`.split("; XSRF-TOKEN=");return s.length===2&&s.pop()?.split(";").shift()||""}async function Fe(){try{const r=await fetch("/api/yosmart/devices",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart devices:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch devices"}}}async function _e(){try{const r=await fetch("/api/yosmart/home",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart home info:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch home info"}}}async function He(r,e,a){try{const s={deviceId:r,deviceToken:e,...a&&{deviceType:a}},n=await fetch("/api/yosmart/device/state",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":oe()},credentials:"include",body:JSON.stringify(s)}),l=await n.json();return!n.ok&&!l.success?{success:!1,error:l.hint||l.error||`HTTP ${n.status}`,code:l.code}:l}catch(s){return console.error(`Failed to get state for device ${r}:`,s),{success:!1,error:s instanceof Error?s.message:"Failed to get device state"}}}async function $e(r,e,a,s){try{const n=await fetch("/api/yosmart/device/control",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":oe()},credentials:"include",body:JSON.stringify({deviceId:r,method:e,params:a||{},token:s})});if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}catch(n){return console.error(`Failed to control device ${r}:`,n),{success:!1,error:n instanceof Error?n.message:"Failed to control device"}}}async function De(){try{const r=await fetch("/api/yosmart/device/states",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),e=await r.json();return!r.ok&&!e.success?{success:!1,error:e.error||`HTTP ${r.status}`}:e}catch(r){return console.error("Failed to fetch all device states:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch device states"}}}function Le(){const[r,e]=T.useState([]),[a,s]=T.useState(null),[n,l]=T.useState({}),[c,f]=T.useState(!0),[m,u]=T.useState(null),[d,h]=T.useState(null),p=T.useCallback(async()=>{try{f(!0),u(null);const o=await Fe();o.success&&o.devices?(e(o.devices),h(new Date)):(u(o.error||"Failed to load devices"),e([]))}catch(o){const S=o instanceof Error?o.message:"Unknown error";u(S),e([])}finally{f(!1)}},[]),x=T.useCallback(async()=>{try{const o=await _e();o.success&&o.home?s(o.home.homeId||o.home.id):console.warn("Failed to load home info:",o.error)}catch(o){console.error("Home info error:",o)}},[]),i=T.useCallback(async(o,S,y)=>{try{l(N=>({...N,[o]:{...N[o]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const g=await He(o,S,y);if(g.success&&g.state)return l(N=>({...N,[o]:{loading:!1,state:g.state,error:null,lastUpdated:new Date}})),g.state;{const N=g.error||"Failed to get state";return l(v=>({...v,[o]:{...v[o]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:N}})),null}}catch(g){const N=g instanceof Error?g.message:"Unknown error";return l(v=>({...v,[o]:{...v[o]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:N}})),null}},[]),j=T.useCallback(async(o,S,y,g)=>{try{l(v=>({...v,[o]:{...v[o]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const N=await $e(o,S,y,g);if(N.success&&N.data)return l(v=>({...v,[o]:{loading:!1,state:N.data,error:null,lastUpdated:new Date}})),N.data;{const v=N.error||"Failed to control device";return l(C=>({...C,[o]:{...C[o]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:v}})),null}}catch(N){const v=N instanceof Error?N.message:"Unknown error";return l(C=>({...C,[o]:{...C[o]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:v}})),null}},[]),b=T.useCallback(()=>{p(),x()},[p,x]),k=T.useCallback(async()=>{try{l(S=>{const y={...S};return r.forEach(g=>{y[g.deviceId]={...S[g.deviceId]||{state:null,error:null,lastUpdated:null},loading:!0,error:null}}),y});const o=await De();if(o.success&&o.devices){const S={};for(const y of o.devices)S[y.deviceId]={loading:!1,state:y.success?y.state:null,error:y.success?null:y.error||"Failed",lastUpdated:y.success?new Date:null};l(S),e(o.devices.map(y=>({deviceId:y.deviceId,name:y.name,type:y.deviceType,modelName:y.modelName||"",...y}))),h(new Date)}else console.error("Failed to fetch all device states:",o.error)}catch(o){console.error("fetchAllStates error:",o)}},[r]);T.useEffect(()=>{p(),x()},[p,x]);const w=T.useCallback(o=>n[o]||{loading:!1,state:null,error:null,lastUpdated:null},[n]);return{devices:r,homeId:a,deviceStates:n,loading:c,error:m,lastSync:d,refresh:b,getState:i,control:j,getDeviceStatus:w,fetchAllStates:k}}function ce(r){return r*9/5+32}function Ue(r){return(r-32)*5/9}function ee(r,e,a="F"){const s=a.toUpperCase(),n=(e??"f").toLowerCase();let l=r;return n==="c"&&s==="F"?l=ce(r):n==="f"&&s==="C"?l=Ue(r):n==="c"&&s==="C"&&(l=r),`${l.toFixed(1)}°${s}`}function Me(r){return r?new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function de(r){const e=Math.floor((Date.now()-r.getTime())/1e3);if(e<60)return"just now";const a=Math.floor(e/60);if(a<60)return`${a}m ago`;const s=Math.floor(a/60);return s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`}function Ae(r){const e=z.c(3),{level:a}=r;if(a<=1){let n;return e[0]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx(be,{className:"size-4 text-red-500"}),e[0]=n):n=e[0],n}if(a<=2){let n;return e[1]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx(ke,{className:"size-4 text-amber-500"}),e[1]=n):n=e[1],n}let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(ye,{className:"size-4 text-emerald-500"}),e[2]=s):s=e[2],s}function ne(r){return{0:"0%",1:"25%",2:"50%",3:"75%",4:"100%"}[r]??`${r}`}function Re(r,e){const a=(e??"f").toLowerCase()==="c"?ce(r):r;return a<=0?"text-blue-600 dark:text-blue-400":a<=32?"text-sky-600 dark:text-sky-400":a<=60?"text-teal-600 dark:text-teal-400":a<=80?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}function Ee(r){switch(r){case"THSensor":return t.jsx(te,{className:"size-5"});case"Hub":return t.jsx(se,{className:"size-5"});default:return t.jsx(ae,{className:"size-5"})}}function Oe(r){const e=z.c(13),{icon:a,label:s,value:n,valueClass:l}=r;let c;e[0]!==a?(c=t.jsx("span",{className:"text-muted-foreground",children:a}),e[0]=a,e[1]=c):c=e[1];let f;e[2]!==s?(f=t.jsx("span",{className:"text-[11px] uppercase tracking-wider text-muted-foreground",children:s}),e[2]=s,e[3]=f):f=e[3];const m=l??"text-sm font-semibold";let u;e[4]!==m||e[5]!==n?(u=t.jsx("span",{className:m,children:n}),e[4]=m,e[5]=n,e[6]=u):u=e[6];let d;e[7]!==f||e[8]!==u?(d=t.jsxs("div",{className:"flex flex-col",children:[f,u]}),e[7]=f,e[8]=u,e[9]=d):d=e[9];let h;return e[10]!==c||e[11]!==d?(h=t.jsxs("div",{className:"flex items-center gap-2",children:[c,d]}),e[10]=c,e[11]=d,e[12]=h):h=e[12],h}function Be(){const r=z.c(3);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=t.jsx(F,{className:"size-10 rounded-lg"}),r[0]=e):e=r[0];let a;r[1]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(W,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[e,t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(F,{className:"h-4 w-28"}),t.jsx(F,{className:"h-3 w-20"})]}),t.jsx(F,{className:"h-5 w-14 rounded-full"})]})}),r[1]=a):a=r[1];let s;return r[2]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsxs(_,{className:"overflow-hidden",children:[a,t.jsxs(H,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(F,{className:"h-16 rounded-lg"}),t.jsx(F,{className:"h-16 rounded-lg"})]}),t.jsx(F,{className:"h-8 w-full rounded-lg"})]})]}),r[2]=s):s=r[2],s}function Ie(r){const e=z.c(34),{devices:a,deviceStates:s}=r,n=a.length;let l;if(e[0]!==s||e[1]!==a){let g;e[3]!==s?(g=N=>s[N.deviceId]?.state?.online===!0,e[3]=s,e[4]=g):g=e[4],l=a.filter(g),e[0]=s,e[1]=a,e[2]=l}else l=e[2];const c=l.length;let f;if(e[5]!==s||e[6]!==a){let g;e[8]!==s?(g=N=>{const v=s[N.deviceId];return v?.state&&v.state.online===!1},e[8]=s,e[9]=g):g=e[9],f=a.filter(g),e[5]=s,e[6]=a,e[7]=f}else f=e[7];const m=f.length;let u;if(e[10]!==s||e[11]!==a){let g;e[13]!==s?(g=N=>{const C=s[N.deviceId]?.state?.state?.alarm;return C?C.lowBattery||C.lowTemp||C.highTemp||C.lowHumidity||C.highHumidity:!1},e[13]=s,e[14]=g):g=e[14],u=a.filter(g),e[10]=s,e[11]=a,e[12]=u}else u=e[12];const d=u.length;let h;e[15]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx(ae,{className:"size-4"}),e[15]=h):h=e[15];let p;e[16]!==n?(p={label:"Total Devices",value:n,icon:h,color:"text-foreground",bg:"bg-muted/50"},e[16]=n,e[17]=p):p=e[17];let x;e[18]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(le,{className:"size-4 text-emerald-500"}),e[18]=x):x=e[18];let i;e[19]!==c?(i={label:"Online",value:c,icon:x,color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-50 dark:bg-emerald-950/30"},e[19]=c,e[20]=i):i=e[20];let j;e[21]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(Z,{className:"size-4 text-red-500"}),e[21]=j):j=e[21];let b;e[22]!==m?(b={label:"Offline",value:m,icon:j,color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-950/30"},e[22]=m,e[23]=b):b=e[23];let k;e[24]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(re,{className:"size-4 text-amber-500"}),e[24]=k):k=e[24];let w;e[25]!==d?(w={label:"Alerts",value:d,icon:k,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-950/30"},e[25]=d,e[26]=w):w=e[26];let o;e[27]!==w||e[28]!==p||e[29]!==i||e[30]!==b?(o=[p,i,b,w],e[27]=w,e[28]=p,e[29]=i,e[30]=b,e[31]=o):o=e[31];const S=o;let y;return e[32]!==S?(y=t.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:S.map(Pe)}),e[32]=S,e[33]=y):y=e[33],y}function Pe(r){return t.jsx(_,{className:`${r.bg} border-0 shadow-none py-4`,children:t.jsxs(H,{className:"flex items-center gap-3 px-4 py-0",children:[r.icon,t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:r.label}),t.jsx("p",{className:`text-xl font-bold ${r.color}`,children:r.value})]})]})},r.label)}function Ye(r){const e=z.c(57),{device:a,status:s,onRefresh:n,targetUnit:l}=r,c=s.state,f=c?.online,m=c?.state,u=c?.reportAt,d=m?.temperature,h=m?.humidity,p=m?.battery,x=m?.mode,i=m?.alarm,j=i&&(i.lowBattery||i.lowTemp||i.highTemp||i.lowHumidity||i.highHumidity);let b;e[0]!==x||e[1]!==d?(b=d!==void 0&&d<=32&&(x??"f").toLowerCase()!=="c",e[0]=x,e[1]=d,e[2]=b):b=e[2];const k=b;let w;e[3]!==x||e[4]!==d?(w=d!==void 0&&d<=0&&(x??"f").toLowerCase()==="c",e[3]=x,e[4]=d,e[5]=w):w=e[5];const o=w,S=`flex size-10 items-center justify-center rounded-lg ${k||o?"bg-blue-100 text-blue-600 dark:bg-blue-900/40 dark:text-blue-400":"bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400"}`;let y;e[6]!==k||e[7]!==o?(y=k||o?t.jsx(Te,{className:"size-5"}):t.jsx(te,{className:"size-5"}),e[6]=k,e[7]=o,e[8]=y):y=e[8];let g;e[9]!==S||e[10]!==y?(g=t.jsx("div",{className:S,children:y}),e[9]=S,e[10]=y,e[11]=g):g=e[11];let N;e[12]!==a.name?(N=t.jsx(V,{className:"text-base",children:a.name}),e[12]=a.name,e[13]=N):N=e[13];let v;e[14]!==a.modelName?(v=t.jsx(Q,{className:"text-xs",children:a.modelName}),e[14]=a.modelName,e[15]=v):v=e[15];let C;e[16]!==N||e[17]!==v?(C=t.jsxs("div",{children:[N,v]}),e[16]=N,e[17]=v,e[18]=C):C=e[18];let $;e[19]!==g||e[20]!==C?($=t.jsxs("div",{className:"flex items-center gap-3",children:[g,C]}),e[19]=g,e[20]=C,e[21]=$):$=e[21];let D;e[22]!==i||e[23]!==j?(D=j&&t.jsxs(q,{children:[t.jsx(G,{children:t.jsxs(K,{variant:"destructive",className:"gap-1 text-[10px]",children:[t.jsx(re,{className:"size-3"})," Alert"]})}),t.jsxs(J,{children:[i.lowTemp&&t.jsx("p",{children:"Low temperature alarm"}),i.highTemp&&t.jsx("p",{children:"High temperature alarm"}),i.lowBattery&&t.jsx("p",{children:"Low battery"}),i.lowHumidity&&t.jsx("p",{children:"Low humidity alarm"}),i.highHumidity&&t.jsx("p",{children:"High humidity alarm"})]})]}),e[22]=i,e[23]=j,e[24]=D):D=e[24];let L;e[25]!==c||e[26]!==f?(L=c?t.jsx(K,{variant:f?"secondary":"destructive",className:`text-[10px] ${f?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:f?t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"size-3"})," Online"]}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{className:"size-3"})," Offline"]})}):null,e[25]=c,e[26]=f,e[27]=L):L=e[27];let U;e[28]!==D||e[29]!==L?(U=t.jsxs("div",{className:"flex items-center gap-1.5",children:[D,L]}),e[28]=D,e[29]=L,e[30]=U):U=e[30];let M;e[31]!==U||e[32]!==$?(M=t.jsx(W,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[$,U]})}),e[31]=U,e[32]=$,e[33]=M):M=e[33];let A;e[34]!==p||e[35]!==c||e[36]!==h||e[37]!==x||e[38]!==u||e[39]!==m||e[40]!==s.error||e[41]!==s.loading||e[42]!==l||e[43]!==d?(A=s.loading&&!c?t.jsxs("div",{className:"flex items-center justify-center py-6 text-muted-foreground",children:[t.jsx(I,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Fetching sensor data…"})]}):s.error&&!c?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):c?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-end justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[11px] uppercase tracking-wider text-muted-foreground mb-0.5",children:"Temperature"}),t.jsx("p",{className:`text-3xl font-bold tabular-nums leading-none ${Re(d,x)}`,children:ee(d,x,l)})]}),h!==void 0&&h>0&&t.jsx(Oe,{icon:t.jsx(he,{className:"size-4 text-sky-500"}),label:"Humidity",value:`${h}%`,valueClass:"text-sm font-semibold text-sky-600 dark:text-sky-400"})]}),t.jsx(fe,{}),t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs(q,{children:[t.jsx(G,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[t.jsx(Ae,{level:p??0}),t.jsx("span",{children:ne(p??0)})]})}),t.jsxs(J,{children:["Battery level: ",ne(p??0)]})]}),m?.loraInfo&&t.jsxs(q,{children:[t.jsx(G,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(Se,{className:"size-3.5"}),t.jsx("span",{children:m.loraInfo.devNetType})]})}),t.jsxs(J,{children:["LoRa network type ",m.loraInfo.devNetType]})]}),t.jsxs(q,{children:[t.jsx(G,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(pe,{className:"size-3.5"}),t.jsx("span",{children:Me(u)})]})}),t.jsxs(J,{children:["Last report: ",u??"unknown"]})]})]}),m?.tempLimit&&m.tempLimit.min>-999&&t.jsxs("div",{className:"rounded-md bg-muted/50 px-3 py-1.5 text-[11px] text-muted-foreground",children:["Temp range: ",ee(m.tempLimit.min,x,l)," — ",ee(m.tempLimit.max,x,l)]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center text-muted-foreground",children:[t.jsx(te,{className:"size-8 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[34]=p,e[35]=c,e[36]=h,e[37]=x,e[38]=u,e[39]=m,e[40]=s.error,e[41]=s.loading,e[42]=l,e[43]=d,e[44]=A):A=e[44];let R;e[45]!==s.loading?(R=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[45]=s.loading,e[46]=R):R=e[46];let E;e[47]!==n||e[48]!==s.loading||e[49]!==R?(E=t.jsx(B,{variant:"outline",size:"sm",className:"w-full",onClick:n,disabled:s.loading,children:R}),e[47]=n,e[48]=s.loading,e[49]=R,e[50]=E):E=e[50];let O;e[51]!==A||e[52]!==E?(O=t.jsxs(H,{className:"space-y-3 pb-4",children:[A,E]}),e[51]=A,e[52]=E,e[53]=O):O=e[53];let X;return e[54]!==M||e[55]!==O?(X=t.jsxs(_,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[M,O]}),e[54]=M,e[55]=O,e[56]=X):X=e[56],X}function We(r){const e=z.c(31),{device:a,status:s,onRefresh:n}=r,l=s.state,c=l?.online;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-violet-100 text-violet-600 dark:bg-violet-900/40 dark:text-violet-400",children:t.jsx(se,{className:"size-5"})}),e[0]=f):f=e[0];let m;e[1]!==a.name?(m=t.jsx(V,{className:"text-base",children:a.name}),e[1]=a.name,e[2]=m):m=e[2];let u;e[3]!==a.modelName?(u=t.jsx(Q,{className:"text-xs",children:a.modelName}),e[3]=a.modelName,e[4]=u):u=e[4];let d;e[5]!==m||e[6]!==u?(d=t.jsxs("div",{className:"flex items-center gap-3",children:[f,t.jsxs("div",{children:[m,u]})]}),e[5]=m,e[6]=u,e[7]=d):d=e[7];let h;e[8]!==l||e[9]!==c?(h=l?t.jsx(K,{variant:c?"secondary":"destructive",className:`text-[10px] ${c?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:c?t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"size-3"})," Online"]}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{className:"size-3"})," Offline"]})}):null,e[8]=l,e[9]=c,e[10]=h):h=e[10];let p;e[11]!==d||e[12]!==h?(p=t.jsx(W,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[d,h]})}),e[11]=d,e[12]=h,e[13]=p):p=e[13];let x;e[14]!==l||e[15]!==s.error||e[16]!==s.lastUpdated||e[17]!==s.loading?(x=s.loading&&!l?t.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[t.jsx(I,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Fetching hub status…"})]}):s.error&&!l?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):l?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:"Hub is the central bridge connecting all YoLink sensors."}),l.state?.version&&t.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Firmware: ",t.jsx("span",{className:"font-mono",children:l.state.version})]}),l.state?.wifi&&t.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["WiFi SSID: ",t.jsx("span",{className:"font-medium",children:l.state.wifi.ssid})]})]}),s.lastUpdated&&t.jsxs("p",{className:"text-[11px] text-muted-foreground text-right",children:["Updated ",de(s.lastUpdated)]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground",children:[t.jsx(se,{className:"size-8 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[14]=l,e[15]=s.error,e[16]=s.lastUpdated,e[17]=s.loading,e[18]=x):x=e[18];let i;e[19]!==s.loading?(i=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[19]=s.loading,e[20]=i):i=e[20];let j;e[21]!==n||e[22]!==s.loading||e[23]!==i?(j=t.jsx(B,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:n,disabled:s.loading,children:i}),e[21]=n,e[22]=s.loading,e[23]=i,e[24]=j):j=e[24];let b;e[25]!==x||e[26]!==j?(b=t.jsxs(H,{className:"pb-4",children:[x,j]}),e[25]=x,e[26]=j,e[27]=b):b=e[27];let k;return e[28]!==b||e[29]!==p?(k=t.jsxs(_,{className:"overflow-hidden border-2 border-dashed transition-shadow hover:shadow-md",children:[p,b]}),e[28]=b,e[29]=p,e[30]=k):k=e[30],k}function Xe(r){const e=z.c(37),{device:a,status:s,onRefresh:n}=r,l=s.state,c=l?.online;let f;e[0]!==a.type?(f=Ee(a.type),e[0]=a.type,e[1]=f):f=e[1];let m;e[2]!==f?(m=t.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-muted text-muted-foreground",children:f}),e[2]=f,e[3]=m):m=e[3];let u;e[4]!==a.name?(u=t.jsx(V,{className:"text-base",children:a.name}),e[4]=a.name,e[5]=u):u=e[5];let d;e[6]!==a.modelName||e[7]!==a.type?(d=t.jsxs(Q,{className:"text-xs",children:[a.type," · ",a.modelName]}),e[6]=a.modelName,e[7]=a.type,e[8]=d):d=e[8];let h;e[9]!==u||e[10]!==d?(h=t.jsxs("div",{children:[u,d]}),e[9]=u,e[10]=d,e[11]=h):h=e[11];let p;e[12]!==m||e[13]!==h?(p=t.jsxs("div",{className:"flex items-center gap-3",children:[m,h]}),e[12]=m,e[13]=h,e[14]=p):p=e[14];let x;e[15]!==l||e[16]!==c?(x=l!=null&&t.jsx(K,{variant:c?"secondary":"destructive",className:`text-[10px] ${c?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:c?"Online":"Offline"}),e[15]=l,e[16]=c,e[17]=x):x=e[17];let i;e[18]!==p||e[19]!==x?(i=t.jsx(W,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[p,x]})}),e[18]=p,e[19]=x,e[20]=i):i=e[20];let j;e[21]!==l||e[22]!==s.error||e[23]!==s.loading?(j=s.loading&&!l?t.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[t.jsx(I,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Loading…"})]}):l?t.jsx("div",{className:"rounded-lg bg-muted/40 p-3",children:t.jsx("pre",{className:"text-xs text-muted-foreground overflow-auto max-h-40 whitespace-pre-wrap break-words",children:JSON.stringify(l.state||l,null,2)})}):s.error?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):t.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No data yet"}),e[21]=l,e[22]=s.error,e[23]=s.loading,e[24]=j):j=e[24];let b;e[25]!==s.loading?(b=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[25]=s.loading,e[26]=b):b=e[26];let k;e[27]!==n||e[28]!==s.loading||e[29]!==b?(k=t.jsx(B,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:n,disabled:s.loading,children:b}),e[27]=n,e[28]=s.loading,e[29]=b,e[30]=k):k=e[30];let w;e[31]!==k||e[32]!==j?(w=t.jsxs(H,{className:"pb-4",children:[j,k]}),e[31]=k,e[32]=j,e[33]=w):w=e[33];let o;return e[34]!==w||e[35]!==i?(o=t.jsxs(_,{className:"overflow-hidden transition-shadow hover:shadow-md",children:[i,w]}),e[34]=w,e[35]=i,e[36]=o):o=e[36],o}function ie(r){const e=z.c(13),{device:a,status:s,onRefresh:n,targetUnit:l}=r;switch(a.type){case"THSensor":{let c;return e[0]!==a||e[1]!==n||e[2]!==s||e[3]!==l?(c=t.jsx(Ye,{device:a,status:s,onRefresh:n,targetUnit:l}),e[0]=a,e[1]=n,e[2]=s,e[3]=l,e[4]=c):c=e[4],c}case"Hub":{let c;return e[5]!==a||e[6]!==n||e[7]!==s?(c=t.jsx(We,{device:a,status:s,onRefresh:n}),e[5]=a,e[6]=n,e[7]=s,e[8]=c):c=e[8],c}default:{let c;return e[9]!==a||e[10]!==n||e[11]!==s?(c=t.jsx(Xe,{device:a,status:s,onRefresh:n}),e[9]=a,e[10]=n,e[11]=s,e[12]=c):c=e[12],c}}}function qe(){const{temperatureUnit:r}=me().props,e=r??"F",{devices:a,deviceStates:s,loading:n,error:l,refresh:c,lastSync:f,fetchAllStates:m,getState:u,getDeviceStatus:d}=Le();if(T.useEffect(()=>{a.length>0&&Object.keys(s).length===0&&m()},[a.length]),n)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:Array.from({length:4}).map((i,j)=>t.jsx(F,{className:"h-20 rounded-xl"},j))}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((i,j)=>t.jsx(Be,{},j))})]});if(l)return t.jsxs(_,{className:"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950/30",children:[t.jsxs(W,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"size-5 text-red-500"}),t.jsx(V,{className:"text-red-700 dark:text-red-400",children:"Connection Error"})]}),t.jsx(Q,{className:"text-red-600/80 dark:text-red-400/80",children:l})]}),t.jsx(H,{children:t.jsxs(B,{variant:"destructive",size:"sm",onClick:()=>c(),children:[t.jsx(Y,{className:"size-4"}),"Try Again"]})})]});const h=[...a].sort((i,j)=>i.type==="Hub"&&j.type!=="Hub"?1:i.type!=="Hub"&&j.type==="Hub"?-1:(i.name??"").localeCompare(j.name??"")),p=h.filter(i=>i.type!=="Hub"),x=h.filter(i=>i.type==="Hub");return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Sensor Dashboard"}),f&&t.jsxs("p",{className:"mt-0.5 text-sm text-muted-foreground",children:["Last synced ",de(f)]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(B,{variant:"default",onClick:()=>m(),children:[t.jsx(ae,{className:"size-4"}),"Refresh All"]}),t.jsxs(B,{variant:"outline",onClick:()=>c(),children:[t.jsx(Y,{className:"size-4"}),"Reload Devices"]})]})]}),t.jsx(Ie,{devices:a,deviceStates:s}),a.length===0&&t.jsx(_,{children:t.jsxs(H,{className:"flex flex-col items-center gap-3 py-12 text-center",children:[t.jsx(Z,{className:"size-12 text-muted-foreground/30"}),t.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"No devices found"}),t.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Make sure your YoSmart Hub is connected and devices are paired."})]})}),p.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:["Sensors (",p.length,")"]}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(i=>t.jsx(ie,{device:i,status:d(i.deviceId),onRefresh:()=>u(i.deviceId,i.token,i.type),targetUnit:e},i.deviceId))})]}),x.length>0&&t.jsxs("div",{children:[t.jsx("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:"Hub"}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map(i=>t.jsx(ie,{device:i,status:d(i.deviceId),onRefresh:()=>u(i.deviceId,i.token,i.type),targetUnit:e},i.deviceId))})]})]})}const Ge=[{title:"Dashboard",href:ge().url}];function dt(){const r=z.c(2);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=t.jsx(xe,{title:"Dashboard"}),r[0]=e):e=r[0];let a;return r[1]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsxs(ue,{breadcrumbs:Ge,children:[e,t.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-4 md:p-6",children:t.jsx(qe,{})})]}),r[1]=a):a=r[1],a}export{dt as default};
