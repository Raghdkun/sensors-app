import{r as C,j as s,c as z,H as ne}from"./app-Ceqq5dSL.js";import{T as Y,a as W,b as X,A as ie}from"./app-layout-DjmKgjDt.js";import{C as _,a as I,b as G,c as J,d as H,R as B,B as q}from"./badge-Mv6pxrcU.js";import{a as O,B as E}from"./app-logo-icon-CdDhz7_B.js";import{S as F,T as V}from"./skeleton-C5-MN2jM.js";import{S as oe}from"./separator-4BbBDQcx.js";import{S as U}from"./spinner-DJM2zdHL.js";import{C as Z}from"./circle-alert-BReKB_UA.js";import{A as ee,S as Q}from"./server-CXi3Yj3d.js";import{W as K,D as ce,C as de}from"./wifi-off-DXVooWAk.js";import{d as me}from"./index-H92Pz0xW.js";/* empty css            */import"./index-DpGmPMZN.js";import"./index-j7bSEhQD.js";import"./loader-circle-BIKxyZHH.js";const xe=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"13",key:"c6fn6x"}]],ue=O("BatteryFull",xe);const fe=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]],he=O("BatteryLow",fe);const pe=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}]],ge=O("BatteryMedium",pe);const je=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],ye=O("Signal",je);const Ne=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],be=O("Snowflake",Ne);const ve=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],se=O("Wifi",ve);function ae(){const r=document.querySelector('meta[name="csrf-token"]');if(r)return r.content;const t=`; ${document.cookie}`.split("; XSRF-TOKEN=");return t.length===2&&t.pop()?.split(";").shift()||""}async function ke(){try{const r=await fetch("/api/yosmart/devices",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart devices:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch devices"}}}async function we(){try{const r=await fetch("/api/yosmart/home",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart home info:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch home info"}}}async function Se(r,e,a){try{const t={deviceId:r,deviceToken:e,...a&&{deviceType:a}},i=await fetch("/api/yosmart/device/state",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":ae()},credentials:"include",body:JSON.stringify(t)}),l=await i.json();return!i.ok&&!l.success?{success:!1,error:l.hint||l.error||`HTTP ${i.status}`,code:l.code}:l}catch(t){return console.error(`Failed to get state for device ${r}:`,t),{success:!1,error:t instanceof Error?t.message:"Failed to get device state"}}}async function Te(r,e,a,t){try{const i=await fetch("/api/yosmart/device/control",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":ae()},credentials:"include",body:JSON.stringify({deviceId:r,method:e,params:a||{},token:t})});if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.json()}catch(i){return console.error(`Failed to control device ${r}:`,i),{success:!1,error:i instanceof Error?i.message:"Failed to control device"}}}async function Ce(){try{const r=await fetch("/api/yosmart/device/states",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),e=await r.json();return!r.ok&&!e.success?{success:!1,error:e.error||`HTTP ${r.status}`}:e}catch(r){return console.error("Failed to fetch all device states:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch device states"}}}function ze(){const[r,e]=C.useState([]),[a,t]=C.useState(null),[i,l]=C.useState({}),[h,d]=C.useState(!0),[p,m]=C.useState(null),[x,u]=C.useState(null),o=C.useCallback(async()=>{try{d(!0),m(null);const n=await ke();n.success&&n.devices?(e(n.devices),u(new Date)):(m(n.error||"Failed to load devices"),e([]))}catch(n){const S=n instanceof Error?n.message:"Unknown error";m(S),e([])}finally{d(!1)}},[]),c=C.useCallback(async()=>{try{const n=await we();n.success&&n.home?t(n.home.homeId||n.home.id):console.warn("Failed to load home info:",n.error)}catch(n){console.error("Home info error:",n)}},[]),N=C.useCallback(async(n,S,g)=>{try{l(j=>({...j,[n]:{...j[n]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const f=await Se(n,S,g);if(f.success&&f.state)return l(j=>({...j,[n]:{loading:!1,state:f.state,error:null,lastUpdated:new Date}})),f.state;{const j=f.error||"Failed to get state";return l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:j}})),null}}catch(f){const j=f instanceof Error?f.message:"Unknown error";return l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:j}})),null}},[]),v=C.useCallback(async(n,S,g,f)=>{try{l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const j=await Te(n,S,g,f);if(j.success&&j.data)return l(b=>({...b,[n]:{loading:!1,state:j.data,error:null,lastUpdated:new Date}})),j.data;{const b=j.error||"Failed to control device";return l(T=>({...T,[n]:{...T[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:b}})),null}}catch(j){const b=j instanceof Error?j.message:"Unknown error";return l(T=>({...T,[n]:{...T[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:b}})),null}},[]),y=C.useCallback(()=>{o(),c()},[o,c]),k=C.useCallback(async()=>{try{l(S=>{const g={...S};return r.forEach(f=>{g[f.deviceId]={...S[f.deviceId]||{state:null,error:null,lastUpdated:null},loading:!0,error:null}}),g});const n=await Ce();if(n.success&&n.devices){const S={};for(const g of n.devices)S[g.deviceId]={loading:!1,state:g.success?g.state:null,error:g.success?null:g.error||"Failed",lastUpdated:g.success?new Date:null};l(S),e(n.devices.map(g=>({deviceId:g.deviceId,name:g.name,type:g.deviceType,modelName:g.modelName||"",...g}))),u(new Date)}else console.error("Failed to fetch all device states:",n.error)}catch(n){console.error("fetchAllStates error:",n)}},[r]);C.useEffect(()=>{o(),c()},[o,c]);const w=C.useCallback(n=>i[n]||{loading:!1,state:null,error:null,lastUpdated:null},[i]);return{devices:r,homeId:a,deviceStates:i,loading:h,error:p,lastSync:x,refresh:y,getState:N,control:v,getDeviceStatus:w,fetchAllStates:k}}function Fe(r){return r*9/5+32}function _e(r,e){return e==="c"?`${r.toFixed(1)}°C`:`${r.toFixed(1)}°`}function He(r){return r?new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function le(r){const e=Math.floor((Date.now()-r.getTime())/1e3);if(e<60)return"just now";const a=Math.floor(e/60);if(a<60)return`${a}m ago`;const t=Math.floor(a/60);return t<24?`${t}h ago`:`${Math.floor(t/24)}d ago`}function $e(r){const e=z.c(3),{level:a}=r;if(a<=1){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(he,{className:"size-4 text-red-500"}),e[0]=i):i=e[0],i}if(a<=2){let i;return e[1]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(ge,{className:"size-4 text-amber-500"}),e[1]=i):i=e[1],i}let t;return e[2]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx(ue,{className:"size-4 text-emerald-500"}),e[2]=t):t=e[2],t}function te(r){return{0:"0%",1:"25%",2:"50%",3:"75%",4:"100%"}[r]??`${r}`}function De(r,e){const a=e==="c"?Fe(r):r;return a<=0?"text-blue-600 dark:text-blue-400":a<=32?"text-sky-600 dark:text-sky-400":a<=60?"text-teal-600 dark:text-teal-400":a<=80?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}function Le(r){switch(r){case"THSensor":return s.jsx(V,{className:"size-5"});case"Hub":return s.jsx(Q,{className:"size-5"});default:return s.jsx(ee,{className:"size-5"})}}function Me(r){const e=z.c(13),{icon:a,label:t,value:i,valueClass:l}=r;let h;e[0]!==a?(h=s.jsx("span",{className:"text-muted-foreground",children:a}),e[0]=a,e[1]=h):h=e[1];let d;e[2]!==t?(d=s.jsx("span",{className:"text-[11px] uppercase tracking-wider text-muted-foreground",children:t}),e[2]=t,e[3]=d):d=e[3];const p=l??"text-sm font-semibold";let m;e[4]!==p||e[5]!==i?(m=s.jsx("span",{className:p,children:i}),e[4]=p,e[5]=i,e[6]=m):m=e[6];let x;e[7]!==d||e[8]!==m?(x=s.jsxs("div",{className:"flex flex-col",children:[d,m]}),e[7]=d,e[8]=m,e[9]=x):x=e[9];let u;return e[10]!==h||e[11]!==x?(u=s.jsxs("div",{className:"flex items-center gap-2",children:[h,x]}),e[10]=h,e[11]=x,e[12]=u):u=e[12],u}function Ae(){const r=z.c(3);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=s.jsx(F,{className:"size-10 rounded-lg"}),r[0]=e):e=r[0];let a;r[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsx(I,{className:"pb-2",children:s.jsxs("div",{className:"flex items-center gap-3",children:[e,s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(F,{className:"h-4 w-28"}),s.jsx(F,{className:"h-3 w-20"})]}),s.jsx(F,{className:"h-5 w-14 rounded-full"})]})}),r[1]=a):a=r[1];let t;return r[2]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsxs(_,{className:"overflow-hidden",children:[a,s.jsxs(H,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(F,{className:"h-16 rounded-lg"}),s.jsx(F,{className:"h-16 rounded-lg"})]}),s.jsx(F,{className:"h-8 w-full rounded-lg"})]})]}),r[2]=t):t=r[2],t}function Re(r){const e=z.c(34),{devices:a,deviceStates:t}=r,i=a.length;let l;if(e[0]!==t||e[1]!==a){let f;e[3]!==t?(f=j=>t[j.deviceId]?.state?.online===!0,e[3]=t,e[4]=f):f=e[4],l=a.filter(f),e[0]=t,e[1]=a,e[2]=l}else l=e[2];const h=l.length;let d;if(e[5]!==t||e[6]!==a){let f;e[8]!==t?(f=j=>{const b=t[j.deviceId];return b?.state&&b.state.online===!1},e[8]=t,e[9]=f):f=e[9],d=a.filter(f),e[5]=t,e[6]=a,e[7]=d}else d=e[7];const p=d.length;let m;if(e[10]!==t||e[11]!==a){let f;e[13]!==t?(f=j=>{const T=t[j.deviceId]?.state?.state?.alarm;return T?T.lowBattery||T.lowTemp||T.highTemp||T.lowHumidity||T.highHumidity:!1},e[13]=t,e[14]=f):f=e[14],m=a.filter(f),e[10]=t,e[11]=a,e[12]=m}else m=e[12];const x=m.length;let u;e[15]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(ee,{className:"size-4"}),e[15]=u):u=e[15];let o;e[16]!==i?(o={label:"Total Devices",value:i,icon:u,color:"text-foreground",bg:"bg-muted/50"},e[16]=i,e[17]=o):o=e[17];let c;e[18]===Symbol.for("react.memo_cache_sentinel")?(c=s.jsx(se,{className:"size-4 text-emerald-500"}),e[18]=c):c=e[18];let N;e[19]!==h?(N={label:"Online",value:h,icon:c,color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-50 dark:bg-emerald-950/30"},e[19]=h,e[20]=N):N=e[20];let v;e[21]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(K,{className:"size-4 text-red-500"}),e[21]=v):v=e[21];let y;e[22]!==p?(y={label:"Offline",value:p,icon:v,color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-950/30"},e[22]=p,e[23]=y):y=e[23];let k;e[24]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx(Z,{className:"size-4 text-amber-500"}),e[24]=k):k=e[24];let w;e[25]!==x?(w={label:"Alerts",value:x,icon:k,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-950/30"},e[25]=x,e[26]=w):w=e[26];let n;e[27]!==w||e[28]!==o||e[29]!==N||e[30]!==y?(n=[o,N,y,w],e[27]=w,e[28]=o,e[29]=N,e[30]=y,e[31]=n):n=e[31];const S=n;let g;return e[32]!==S?(g=s.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:S.map(Ee)}),e[32]=S,e[33]=g):g=e[33],g}function Ee(r){return s.jsx(_,{className:`${r.bg} border-0 shadow-none py-4`,children:s.jsxs(H,{className:"flex items-center gap-3 px-4 py-0",children:[r.icon,s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:r.label}),s.jsx("p",{className:`text-xl font-bold ${r.color}`,children:r.value})]})]})},r.label)}function Ue(r){const e=z.c(50),{device:a,status:t,onRefresh:i}=r,l=t.state,h=l?.online,d=l?.state,p=l?.reportAt,m=d?.temperature,x=d?.humidity,u=d?.battery,o=d?.mode,c=d?.alarm,N=c&&(c.lowBattery||c.lowTemp||c.highTemp||c.lowHumidity||c.highHumidity),v=m!==void 0&&m<=32&&o!=="c",y=m!==void 0&&m<=0&&o==="c",k=`flex size-10 items-center justify-center rounded-lg ${v||y?"bg-blue-100 text-blue-600 dark:bg-blue-900/40 dark:text-blue-400":"bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400"}`;let w;e[0]!==v||e[1]!==y?(w=v||y?s.jsx(be,{className:"size-5"}):s.jsx(V,{className:"size-5"}),e[0]=v,e[1]=y,e[2]=w):w=e[2];let n;e[3]!==k||e[4]!==w?(n=s.jsx("div",{className:k,children:w}),e[3]=k,e[4]=w,e[5]=n):n=e[5];let S;e[6]!==a.name?(S=s.jsx(G,{className:"text-base",children:a.name}),e[6]=a.name,e[7]=S):S=e[7];let g;e[8]!==a.modelName?(g=s.jsx(J,{className:"text-xs",children:a.modelName}),e[8]=a.modelName,e[9]=g):g=e[9];let f;e[10]!==S||e[11]!==g?(f=s.jsxs("div",{children:[S,g]}),e[10]=S,e[11]=g,e[12]=f):f=e[12];let j;e[13]!==n||e[14]!==f?(j=s.jsxs("div",{className:"flex items-center gap-3",children:[n,f]}),e[13]=n,e[14]=f,e[15]=j):j=e[15];let b;e[16]!==c||e[17]!==N?(b=N&&s.jsxs(Y,{children:[s.jsx(W,{children:s.jsxs(q,{variant:"destructive",className:"gap-1 text-[10px]",children:[s.jsx(Z,{className:"size-3"})," Alert"]})}),s.jsxs(X,{children:[c.lowTemp&&s.jsx("p",{children:"Low temperature alarm"}),c.highTemp&&s.jsx("p",{children:"High temperature alarm"}),c.lowBattery&&s.jsx("p",{children:"Low battery"}),c.lowHumidity&&s.jsx("p",{children:"Low humidity alarm"}),c.highHumidity&&s.jsx("p",{children:"High humidity alarm"})]})]}),e[16]=c,e[17]=N,e[18]=b):b=e[18];let T;e[19]!==l||e[20]!==h?(T=l?s.jsx(q,{variant:h?"secondary":"destructive",className:`text-[10px] ${h?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:h?s.jsxs(s.Fragment,{children:[s.jsx(se,{className:"size-3"})," Online"]}):s.jsxs(s.Fragment,{children:[s.jsx(K,{className:"size-3"})," Offline"]})}):null,e[19]=l,e[20]=h,e[21]=T):T=e[21];let $;e[22]!==b||e[23]!==T?($=s.jsxs("div",{className:"flex items-center gap-1.5",children:[b,T]}),e[22]=b,e[23]=T,e[24]=$):$=e[24];let D;e[25]!==$||e[26]!==j?(D=s.jsx(I,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[j,$]})}),e[25]=$,e[26]=j,e[27]=D):D=e[27];let L;e[28]!==u||e[29]!==l||e[30]!==x||e[31]!==o||e[32]!==p||e[33]!==d||e[34]!==t.error||e[35]!==t.loading||e[36]!==m?(L=t.loading&&!l?s.jsxs("div",{className:"flex items-center justify-center py-6 text-muted-foreground",children:[s.jsx(U,{className:"size-5 mr-2"}),s.jsx("span",{className:"text-sm",children:"Fetching sensor data…"})]}):t.error&&!l?s.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:t.error})}):l?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-end justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wider text-muted-foreground mb-0.5",children:"Temperature"}),s.jsx("p",{className:`text-3xl font-bold tabular-nums leading-none ${De(m,o)}`,children:_e(m,o)})]}),x!==void 0&&x>0&&s.jsx(Me,{icon:s.jsx(ce,{className:"size-4 text-sky-500"}),label:"Humidity",value:`${x}%`,valueClass:"text-sm font-semibold text-sky-600 dark:text-sky-400"})]}),s.jsx(oe,{}),s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsxs(Y,{children:[s.jsx(W,{asChild:!0,children:s.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[s.jsx($e,{level:u??0}),s.jsx("span",{children:te(u??0)})]})}),s.jsxs(X,{children:["Battery level: ",te(u??0)]})]}),d?.loraInfo&&s.jsxs(Y,{children:[s.jsx(W,{asChild:!0,children:s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(ye,{className:"size-3.5"}),s.jsx("span",{children:d.loraInfo.devNetType})]})}),s.jsxs(X,{children:["LoRa network type ",d.loraInfo.devNetType]})]}),s.jsxs(Y,{children:[s.jsx(W,{asChild:!0,children:s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(de,{className:"size-3.5"}),s.jsx("span",{children:He(p)})]})}),s.jsxs(X,{children:["Last report: ",p??"unknown"]})]})]}),d?.tempLimit&&d.tempLimit.min>-999&&s.jsxs("div",{className:"rounded-md bg-muted/50 px-3 py-1.5 text-[11px] text-muted-foreground",children:["Temp range: ",d.tempLimit.min,"° — ",d.tempLimit.max,"°"]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center text-muted-foreground",children:[s.jsx(V,{className:"size-8 opacity-30"}),s.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[28]=u,e[29]=l,e[30]=x,e[31]=o,e[32]=p,e[33]=d,e[34]=t.error,e[35]=t.loading,e[36]=m,e[37]=L):L=e[37];let M;e[38]!==t.loading?(M=t.loading?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"size-3.5"}),s.jsx("span",{children:"Updating…"})]}):s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"size-3.5"}),s.jsx("span",{children:"Refresh"})]}),e[38]=t.loading,e[39]=M):M=e[39];let A;e[40]!==i||e[41]!==t.loading||e[42]!==M?(A=s.jsx(E,{variant:"outline",size:"sm",className:"w-full",onClick:i,disabled:t.loading,children:M}),e[40]=i,e[41]=t.loading,e[42]=M,e[43]=A):A=e[43];let R;e[44]!==L||e[45]!==A?(R=s.jsxs(H,{className:"space-y-3 pb-4",children:[L,A]}),e[44]=L,e[45]=A,e[46]=R):R=e[46];let P;return e[47]!==D||e[48]!==R?(P=s.jsxs(_,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[D,R]}),e[47]=D,e[48]=R,e[49]=P):P=e[49],P}function Oe(r){const e=z.c(31),{device:a,status:t,onRefresh:i}=r,l=t.state,h=l?.online;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-violet-100 text-violet-600 dark:bg-violet-900/40 dark:text-violet-400",children:s.jsx(Q,{className:"size-5"})}),e[0]=d):d=e[0];let p;e[1]!==a.name?(p=s.jsx(G,{className:"text-base",children:a.name}),e[1]=a.name,e[2]=p):p=e[2];let m;e[3]!==a.modelName?(m=s.jsx(J,{className:"text-xs",children:a.modelName}),e[3]=a.modelName,e[4]=m):m=e[4];let x;e[5]!==p||e[6]!==m?(x=s.jsxs("div",{className:"flex items-center gap-3",children:[d,s.jsxs("div",{children:[p,m]})]}),e[5]=p,e[6]=m,e[7]=x):x=e[7];let u;e[8]!==l||e[9]!==h?(u=l?s.jsx(q,{variant:h?"secondary":"destructive",className:`text-[10px] ${h?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:h?s.jsxs(s.Fragment,{children:[s.jsx(se,{className:"size-3"})," Online"]}):s.jsxs(s.Fragment,{children:[s.jsx(K,{className:"size-3"})," Offline"]})}):null,e[8]=l,e[9]=h,e[10]=u):u=e[10];let o;e[11]!==x||e[12]!==u?(o=s.jsx(I,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[x,u]})}),e[11]=x,e[12]=u,e[13]=o):o=e[13];let c;e[14]!==l||e[15]!==t.error||e[16]!==t.lastUpdated||e[17]!==t.loading?(c=t.loading&&!l?s.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[s.jsx(U,{className:"size-5 mr-2"}),s.jsx("span",{className:"text-sm",children:"Fetching hub status…"})]}):t.error&&!l?s.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:t.error})}):l?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Hub is the central bridge connecting all YoLink sensors."}),l.state?.version&&s.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Firmware: ",s.jsx("span",{className:"font-mono",children:l.state.version})]}),l.state?.wifi&&s.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["WiFi SSID: ",s.jsx("span",{className:"font-medium",children:l.state.wifi.ssid})]})]}),t.lastUpdated&&s.jsxs("p",{className:"text-[11px] text-muted-foreground text-right",children:["Updated ",le(t.lastUpdated)]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground",children:[s.jsx(Q,{className:"size-8 opacity-30"}),s.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[14]=l,e[15]=t.error,e[16]=t.lastUpdated,e[17]=t.loading,e[18]=c):c=e[18];let N;e[19]!==t.loading?(N=t.loading?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"size-3.5"}),s.jsx("span",{children:"Updating…"})]}):s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"size-3.5"}),s.jsx("span",{children:"Refresh"})]}),e[19]=t.loading,e[20]=N):N=e[20];let v;e[21]!==i||e[22]!==t.loading||e[23]!==N?(v=s.jsx(E,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:i,disabled:t.loading,children:N}),e[21]=i,e[22]=t.loading,e[23]=N,e[24]=v):v=e[24];let y;e[25]!==c||e[26]!==v?(y=s.jsxs(H,{className:"pb-4",children:[c,v]}),e[25]=c,e[26]=v,e[27]=y):y=e[27];let k;return e[28]!==y||e[29]!==o?(k=s.jsxs(_,{className:"overflow-hidden border-2 border-dashed transition-shadow hover:shadow-md",children:[o,y]}),e[28]=y,e[29]=o,e[30]=k):k=e[30],k}function Be(r){const e=z.c(37),{device:a,status:t,onRefresh:i}=r,l=t.state,h=l?.online;let d;e[0]!==a.type?(d=Le(a.type),e[0]=a.type,e[1]=d):d=e[1];let p;e[2]!==d?(p=s.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-muted text-muted-foreground",children:d}),e[2]=d,e[3]=p):p=e[3];let m;e[4]!==a.name?(m=s.jsx(G,{className:"text-base",children:a.name}),e[4]=a.name,e[5]=m):m=e[5];let x;e[6]!==a.modelName||e[7]!==a.type?(x=s.jsxs(J,{className:"text-xs",children:[a.type," · ",a.modelName]}),e[6]=a.modelName,e[7]=a.type,e[8]=x):x=e[8];let u;e[9]!==m||e[10]!==x?(u=s.jsxs("div",{children:[m,x]}),e[9]=m,e[10]=x,e[11]=u):u=e[11];let o;e[12]!==p||e[13]!==u?(o=s.jsxs("div",{className:"flex items-center gap-3",children:[p,u]}),e[12]=p,e[13]=u,e[14]=o):o=e[14];let c;e[15]!==l||e[16]!==h?(c=l!=null&&s.jsx(q,{variant:h?"secondary":"destructive",className:`text-[10px] ${h?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:h?"Online":"Offline"}),e[15]=l,e[16]=h,e[17]=c):c=e[17];let N;e[18]!==o||e[19]!==c?(N=s.jsx(I,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[o,c]})}),e[18]=o,e[19]=c,e[20]=N):N=e[20];let v;e[21]!==l||e[22]!==t.error||e[23]!==t.loading?(v=t.loading&&!l?s.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[s.jsx(U,{className:"size-5 mr-2"}),s.jsx("span",{className:"text-sm",children:"Loading…"})]}):l?s.jsx("div",{className:"rounded-lg bg-muted/40 p-3",children:s.jsx("pre",{className:"text-xs text-muted-foreground overflow-auto max-h-40 whitespace-pre-wrap break-words",children:JSON.stringify(l.state||l,null,2)})}):t.error?s.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:t.error})}):s.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No data yet"}),e[21]=l,e[22]=t.error,e[23]=t.loading,e[24]=v):v=e[24];let y;e[25]!==t.loading?(y=t.loading?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"size-3.5"}),s.jsx("span",{children:"Updating…"})]}):s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"size-3.5"}),s.jsx("span",{children:"Refresh"})]}),e[25]=t.loading,e[26]=y):y=e[26];let k;e[27]!==i||e[28]!==t.loading||e[29]!==y?(k=s.jsx(E,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:i,disabled:t.loading,children:y}),e[27]=i,e[28]=t.loading,e[29]=y,e[30]=k):k=e[30];let w;e[31]!==k||e[32]!==v?(w=s.jsxs(H,{className:"pb-4",children:[v,k]}),e[31]=k,e[32]=v,e[33]=w):w=e[33];let n;return e[34]!==w||e[35]!==N?(n=s.jsxs(_,{className:"overflow-hidden transition-shadow hover:shadow-md",children:[N,w]}),e[34]=w,e[35]=N,e[36]=n):n=e[36],n}function re(r){const e=z.c(12),{device:a,status:t,onRefresh:i}=r;switch(a.type){case"THSensor":{let l;return e[0]!==a||e[1]!==i||e[2]!==t?(l=s.jsx(Ue,{device:a,status:t,onRefresh:i}),e[0]=a,e[1]=i,e[2]=t,e[3]=l):l=e[3],l}case"Hub":{let l;return e[4]!==a||e[5]!==i||e[6]!==t?(l=s.jsx(Oe,{device:a,status:t,onRefresh:i}),e[4]=a,e[5]=i,e[6]=t,e[7]=l):l=e[7],l}default:{let l;return e[8]!==a||e[9]!==i||e[10]!==t?(l=s.jsx(Be,{device:a,status:t,onRefresh:i}),e[8]=a,e[9]=i,e[10]=t,e[11]=l):l=e[11],l}}}function Ie(){const{devices:r,deviceStates:e,loading:a,error:t,refresh:i,lastSync:l,fetchAllStates:h,getState:d,getDeviceStatus:p}=ze();if(C.useEffect(()=>{r.length>0&&Object.keys(e).length===0&&h()},[r.length]),a)return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:Array.from({length:4}).map((o,c)=>s.jsx(F,{className:"h-20 rounded-xl"},c))}),s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((o,c)=>s.jsx(Ae,{},c))})]});if(t)return s.jsxs(_,{className:"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950/30",children:[s.jsxs(I,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"size-5 text-red-500"}),s.jsx(G,{className:"text-red-700 dark:text-red-400",children:"Connection Error"})]}),s.jsx(J,{className:"text-red-600/80 dark:text-red-400/80",children:t})]}),s.jsx(H,{children:s.jsxs(E,{variant:"destructive",size:"sm",onClick:()=>i(),children:[s.jsx(B,{className:"size-4"}),"Try Again"]})})]});const m=[...r].sort((o,c)=>o.type==="Hub"&&c.type!=="Hub"?1:o.type!=="Hub"&&c.type==="Hub"?-1:(o.name??"").localeCompare(c.name??"")),x=m.filter(o=>o.type!=="Hub"),u=m.filter(o=>o.type==="Hub");return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Sensor Dashboard"}),l&&s.jsxs("p",{className:"mt-0.5 text-sm text-muted-foreground",children:["Last synced ",le(l)]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(E,{variant:"default",onClick:()=>h(),children:[s.jsx(ee,{className:"size-4"}),"Refresh All"]}),s.jsxs(E,{variant:"outline",onClick:()=>i(),children:[s.jsx(B,{className:"size-4"}),"Reload Devices"]})]})]}),s.jsx(Re,{devices:r,deviceStates:e}),r.length===0&&s.jsx(_,{children:s.jsxs(H,{className:"flex flex-col items-center gap-3 py-12 text-center",children:[s.jsx(K,{className:"size-12 text-muted-foreground/30"}),s.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"No devices found"}),s.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Make sure your YoSmart Hub is connected and devices are paired."})]})}),x.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:["Sensors (",x.length,")"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map(o=>s.jsx(re,{device:o,status:p(o.deviceId),onRefresh:()=>d(o.deviceId,o.token,o.type)},o.deviceId))})]}),u.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:"Hub"}),s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(o=>s.jsx(re,{device:o,status:p(o.deviceId),onRefresh:()=>d(o.deviceId,o.token,o.type)},o.deviceId))})]})]})}const Pe=[{title:"Dashboard",href:me().url}];function ls(){const r=z.c(2);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=s.jsx(ne,{title:"Dashboard"}),r[0]=e):e=r[0];let a;return r[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsxs(ie,{breadcrumbs:Pe,children:[e,s.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-4 md:p-6",children:s.jsx(Ie,{})})]}),r[1]=a):a=r[1],a}export{ls as default};
